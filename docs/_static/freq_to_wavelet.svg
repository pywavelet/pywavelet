<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 980 360" width="980" height="360">
  <defs>
    <style>
      .panel { fill: #ffffff; stroke: #d0d7de; stroke-width: 2; }
      .axis { stroke: #6e7781; stroke-width: 2; }
      .grid { stroke: #d8dee4; stroke-width: 1; opacity: 0.55; }
      .label { font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial; font-size: 16px; fill: #24292f; }
      .sub { font-size: 13px; fill: #57606a; }
      .sig { fill: none; stroke: #0969da; stroke-width: 2.5; }
      .win { fill: #fb8c00; opacity: 0.18; stroke: #fb8c00; stroke-width: 2; }
      .arrow { stroke: #57606a; stroke-width: 2; marker-end: url(#m); }
      .col { fill: #0969da; opacity: 0.12; }
      .colhot { fill: #cf222e; opacity: 0.18; }
      .dot { fill: #cf222e; }
      .note { font-size: 12px; fill: #57606a; }
    </style>
    <marker id="m" markerWidth="10" markerHeight="10" refX="6" refY="3" orient="auto">
      <path d="M0,0 L6,3 L0,6 Z" fill="#57606a"/>
    </marker>
  </defs>

  <rect class="panel" x="20" y="20" width="300" height="320" rx="12"/>
  <rect class="panel" x="340" y="20" width="300" height="320" rx="12"/>
  <rect class="panel" x="660" y="20" width="300" height="320" rx="12"/>

  <text class="label" x="40" y="48">Freq → wavelet (concept)</text>
  <text class="label sub" x="40" y="70">window a band around each bin</text>

  <text class="label" x="360" y="48">IFFT packet → time bins</text>
  <text class="label sub" x="360" y="70">one packet gives one column</text>

  <text class="label" x="680" y="48">Pack into wavelet grid</text>
  <text class="label sub" x="680" y="70">parity picks real/imag</text>

  <!-- Left: frequency-stream + moving window -->
  <line class="axis" x1="55" y1="295" x2="285" y2="295"/>
  <line class="axis" x1="55" y1="105" x2="55" y2="295"/>
  <line class="grid" x1="112" y1="105" x2="112" y2="295"/>
  <line class="grid" x1="169" y1="105" x2="169" y2="295"/>
  <line class="grid" x1="226" y1="105" x2="226" y2="295"/>
  <path class="sig" d="M55 265 C 80 255, 95 160, 115 170 C 135 180, 145 255, 165 230 C 185 205, 200 140, 220 165 C 240 190, 255 250, 285 240"/>
  <rect class="win" x="70" y="105" width="70" height="190" rx="10">
    <animate attributeName="x" dur="4s" repeatCount="indefinite" values="70;190;70"/>
  </rect>
  <circle class="dot" cx="105" cy="155" r="5">
    <animate attributeName="cx" dur="4s" repeatCount="indefinite" values="105;225;105"/>
    <animate attributeName="cy" dur="4s" repeatCount="indefinite" values="155;175;155"/>
  </circle>
  <text class="note" x="235" y="312">index (jj)</text>

  <!-- Middle: windowed DX + IFFT -->
  <line class="axis" x1="375" y1="295" x2="605" y2="295"/>
  <line class="axis" x1="375" y1="105" x2="375" y2="295"/>
  <line class="grid" x1="432" y1="105" x2="432" y2="295"/>
  <line class="grid" x1="489" y1="105" x2="489" y2="295"/>
  <line class="grid" x1="546" y1="105" x2="546" y2="295"/>
  <path class="sig" d="M375 235 C 400 150, 430 290, 460 215 C 490 165, 515 260, 540 210 C 565 175, 585 230, 605 205"/>
  <rect class="win" x="385" y="105" width="70" height="190" rx="10">
    <animate attributeName="x" dur="4s" repeatCount="indefinite" values="385;505;385"/>
  </rect>
  <text class="note" x="390" y="312">time bins (n)</text>

  <!-- Right: wavelet grid filling columns -->
  <line class="axis" x1="695" y1="295" x2="925" y2="295"/>
  <line class="axis" x1="695" y1="105" x2="695" y2="295"/>
  <g>
    <rect class="col" x="705" y="115" width="18" height="170"/>
    <rect class="col" x="727" y="115" width="18" height="170"/>
    <rect class="col" x="749" y="115" width="18" height="170"/>
    <rect class="col" x="771" y="115" width="18" height="170"/>
    <rect class="col" x="793" y="115" width="18" height="170"/>
    <rect class="col" x="815" y="115" width="18" height="170"/>
    <rect class="col" x="837" y="115" width="18" height="170"/>
    <rect class="col" x="859" y="115" width="18" height="170"/>
    <rect class="col" x="881" y="115" width="18" height="170"/>
  </g>
  <rect class="colhot" x="705" y="115" width="18" height="170">
    <animate attributeName="x" dur="4s" repeatCount="indefinite" values="705;881;705"/>
  </rect>
  <circle class="dot" cx="714" cy="255" r="5">
    <animate attributeName="cx" dur="4s" repeatCount="indefinite" values="714;890;714"/>
    <animate attributeName="cy" dur="4s" repeatCount="indefinite" values="255;140;255"/>
  </circle>
  <text class="note" x="870" y="312">time bins</text>
  <text class="note" x="670" y="120">freq bins</text>

  <!-- arrows between panels -->
  <line class="arrow" x1="320" y1="180" x2="340" y2="180"/>
  <line class="arrow" x1="640" y1="180" x2="660" y2="180"/>
</svg>
